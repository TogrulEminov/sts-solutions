generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  username      String    @unique
  password      String
  emailVerified DateTime?
  image         String?
  role          Role      @default(USER)

  createdById  String?
  createdBy    User?   @relation("UserCreated", fields: [createdById], references: [id])
  createdUsers User[]  @relation("UserCreated")
  isDeleted    Boolean @default(false)

  updatedById    String? // Bu istifadəçi kim tərəfindən yenilənib?
  updatedBy      User?            @relation("UserUpdated", fields: [updatedById], references: [id])
  updatedUsers   User[]           @relation("UserUpdated")
  Categories     Categories[]
  SectionContent SectionContent[]

  @@index([isDeleted])
  @@index([email, username])
  @@index([role])
  @@index([createdById])
  @@index([updatedById])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@index([expires])
}

model File {
  id             Int         @id @default(autoincrement())
  fileKey        String      @unique
  originalName   String
  mimeType       String
  fileSize       Int
  publicUrl      String
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  categoryImage  Categories? @relation("CategoryFiles")
  seoImage       Seo?        @relation("SeoFiles")
  certificatesId Int?

  @@index([createdAt, mimeType]) // Filter by type and date
}

model Seo {
  id              Int                      @id @default(autoincrement())
  metaDescription String
  metaKeywords    String
  metaTitle       String
  locale          Locales                  @default(az)
  imageId         Int?                     @unique
  imageUrl        File?                    @relation("SeoFiles", fields: [imageId], references: [id], onDelete: SetNull)
  categories      CategoriesTranslations[]

  @@index([locale])
  @@index([imageId])
}

model Social {
  id         Int      @id @default(autoincrement())
  socialName String   @unique
  socialLink String   @unique
  iconName   String
  status     Status   @default(published)
  documentId String   @unique @default(cuid())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

enum Status {
  published
  draft
}

// data schema

// categories
model Categories {
  id           Int                      @id @default(autoincrement())
  documentId   String                   @unique @default(cuid())
  slug         String
  isDeleted    Boolean                  @default(false)
  status       Status                   @default(published)
  imageId      Int?                     @unique
  imageUrl     File?                    @relation("CategoryFiles", fields: [imageId], references: [id], onDelete: SetNull)
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  translations CategoriesTranslations[]
  user         User?                    @relation(fields: [userId], references: [id])
  userId       String?

  @@index([isDeleted, status]) // ✅ var
  @@index([slug, isDeleted]) // Slug lookup + filter
  @@index([userId, isDeleted])
  @@index([createdAt]) // ✅ var
}

model CategoriesTranslations {
  id          Int         @id @default(autoincrement())
  title       String
  description String
  locale      Locales     @default(az)
  document    Categories? @relation(fields: [documentId], references: [documentId], onDelete: Cascade)
  documentId  String?
  seo         Seo?        @relation(fields: [seoId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  seoId       Int?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@unique([documentId, locale])
  @@index([locale])
  @@index([documentId])
  @@index([seoId])
  @@index([title])
}

// section
model SectionContent {
  id           Int                          @id @default(autoincrement())
  documentId   String                       @unique @default(cuid())
  status       Status                       @default(published)
  key          String?                      @unique
  createdAt    DateTime                     @default(now())
  updatedAt    DateTime                     @default(now())
  translations SectionContentTranslations[]
  user         User?                        @relation(fields: [userId], references: [id])
  userId       String?
  orderNumber  Int?                         @default(0)
  isDeleted    Boolean                      @default(false)

  @@index([isDeleted])
  @@index([createdAt])
  @@index([status])
  @@index([key])
  @@index([userId])
  @@index([orderNumber])
  @@index([isDeleted, status])
  @@index([isDeleted, key])
}

model SectionContentTranslations {
  id          Int             @id @default(autoincrement())
  title       String
  slug        String?
  subTitle    String?
  locale      Locales         @default(az)
  document    SectionContent? @relation(fields: [documentId], references: [documentId], onDelete: Cascade)
  documentId  String?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  description String?

  @@unique([documentId, locale])
  @@index([title])
  @@index([locale])
  @@index([documentId])
  @@index([slug])
}

enum Locales {
  // Azərbaycan və region
  az @map("az") // Azərbaycanca
  tr @map("tr") // Türkcə
  ru @map("ru") // Rusca

  // Avropa dilləri
  en @map("en") // İngiliscə
  de @map("de") // Almanca
  fr @map("fr") // Fransızca
  es @map("es") // İspanca
  it @map("it") // İtalyanca
  pt @map("pt") // Portuqalca
  nl @map("nl") // Hollandca
  pl @map("pl") // Polyakca
  uk @map("uk") // Ukraynaca
  cs @map("cs") // Çexcə
  sk @map("sk") // Slovakca
  ro @map("ro") // Rumınca
  bg @map("bg") // Bolqarca
  el @map("el") // Yunanca
  sv @map("sv") // İsveçcə
  no @map("no") // Norveçcə
  da @map("da") // Datca
  fi @map("fi") // Fincə
  hu @map("hu") // Macarca

  // Asiya dilləri
  zh @map("zh") // Çincə
  ja @map("ja") // Yaponca
  ko @map("ko") // Koreyaca
  hi @map("hi") // Hindcə
  th @map("th") // Tayca
  vi @map("vi") // Vyetnamca
  id @map("id") // İndoneziyaca
  ms @map("ms") // Malayca

  // Yaxın Şərq dilləri
  ar @map("ar") // Ərəbcə
  fa @map("fa") // Farsca
  he @map("he") // İvrit

  // Digər populyar dillər
  bn @map("bn") // Benqalca
  ur @map("ur") // Urduca
  sw @map("sw") // Suahili
  am @map("am") // Amharca

  // CIS ölkələri
  kk @map("kk") // Qazaxca
  uz @map("uz") // Özbəkçə
  ky @map("ky") // Qırğızca
  tg @map("tg") // Tacikçə
  tk @map("tk") // Türkmənçə
  ka @map("ka") // Gürcücə
  hy @map("hy") // Ermənicə
  be @map("be") // Belarusca

  // Balkan dilləri
  sr @map("sr") // Serbcə
  hr @map("hr") // Xorvatca
  bs @map("bs") // Bosniyaca
  sl @map("sl") // Slovencə
  mk @map("mk") // Makedonca
  sq @map("sq") // Albanca
}

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
  CONTENT_MANAGER
}
